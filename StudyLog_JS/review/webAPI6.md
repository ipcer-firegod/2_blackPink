# Web APIs 第六天核心知识复习记录
## 一、本文档目的
- 梳理 Web APIs 第六天核心知识点（正则表达式全解析、小兔鲜综合案例），重点突出正则表达式语法、元字符应用、表单验证逻辑，非重点内容精简提炼，适配 10 分钟碎片化回顾与 1 小时集中复习。
- 解决“正则匹配不精确”“元字符混淆”“表单验证逻辑漏洞”等高频问题，补充正则转义字符、中文匹配细节、表单验证最佳实践等必要知识点，帮助扎实掌握正则表达式与实战案例开发能力。


## 二、宏观结构（快速导航）
- 核心基础：正则表达式（定义、作用、语法）
- 核心重点：正则元字符（边界符、量词、字符类、预定义类）
- 核心拓展：正则修饰符（i、g）与替换方法（replace）
- 实战应用：综合案例（小兔鲜注册/登录/首页，含表单验证、验证码倒计时、本地存储）
- 补充知识点：正则转义字符、中文匹配 Unicode 范围、表单验证事件触发时机


## 三、核心概念速查（记忆卡）
### 1. 正则表达式（核心重点）
正则表达式是匹配字符串字符组合的模式，核心用于表单验证、敏感词过滤、字符串提取，是前端开发中处理文本的核心工具。

#### （1）核心语法（定义与检测）
| 步骤          | 语法/方法                          | 说明                                  | 示例                          |
|---------------|-----------------------------------|---------------------------------------|-----------------------------------|
| 定义正则      | `const reg = /表达式/`（字面量方式） | `/ /` 为正则分隔符，中间为匹配规则        | `const reg = /^[a-z0-9]{6,16}$/`（用户名正则） |
| 检测匹配      | `reg.test(字符串)`                 | 返回布尔值（true 匹配成功，false 失败），用于表单验证 | `reg.test('user123')` → true |
| 检索匹配      | `reg.exec(字符串)`                 | 返回数组（含匹配结果、索引）或 null，用于提取匹配内容 | `reg.exec('user123')` → ["user123", index: 0] |

- 关键区别：`test` 仅判断是否匹配，`exec` 可获取匹配细节（如位置、分组）。

#### （2）元字符（核心中的核心，分四类详解）
元字符是具有特殊含义的字符，大幅提升匹配灵活性，按功能分类记忆：

##### ① 边界符（控制匹配位置，精准匹配关键）
| 元字符 | 作用                                  | 示例                          | 匹配结果                          |
|--------|---------------------------------------|-----------------------------------|-----------------------------------|
| `^`    | 匹配字符串**开头**                    | `/^abc/` 匹配 "abc123" → true；匹配 "123abc" → false | 仅开头符合规则才匹配              |
| `$`    | 匹配字符串**结尾**                    | `/abc$/` 匹配 "123abc" → true；匹配 "abc123" → false | 仅结尾符合规则才匹配              |
| `^$`   | 精确匹配（字符串完全符合规则）          | `/^abc$/` 匹配 "abc" → true；匹配 "abc123" → false | 常用于表单验证（如验证码、手机号） |

##### ② 量词（控制匹配次数）
| 元字符 | 作用                                  | 示例                          | 注意事项                          |
|--------|---------------------------------------|-----------------------------------|-----------------------------------|
| `*`    | 匹配 0 次或多次                       | `/a*/` 匹配 "" → true；匹配 "aaa" → true | 允许空值                          |
| `+`    | 匹配 1 次或多次                       | `/a+/` 匹配 "" → false；匹配 "aaa" → true | 至少 1 次，用于必填项验证          |
| `?`    | 匹配 0 次或 1 次                       | `/a?/` 匹配 "" → true；匹配 "a" → true；匹配 "aaa" → false | 可选值（如手机号区号）              |
| `{n}`  | 精确匹配 n 次                         | `/a{3}/` 匹配 "aaa" → true；匹配 "aa" → false | 固定长度（如 6 位验证码）          |
| `{n,}`  | 匹配 n 次或更多（≥n）                 | `/a{2,}/` 匹配 "aa" → true；匹配 "aaa" → true | 最小长度（如密码至少 6 位）        |
| `{n,m}` | 匹配 n~m 次（≥n 且 ≤m）              | `/a{2,4}/` 匹配 "aa" → true；匹配 "aaaaa" → false | 长度范围，**逗号两侧无空格**        |

##### ③ 字符类（匹配特定字符集合）
| 元字符格式 | 作用                                  | 示例                          |
|------------|---------------------------------------|-----------------------------------|
| `[abc]`    | 匹配集合中任意单个字符                | `/[abc]/` 匹配 "a" → true；匹配 "d" → false |
| `[a-z]`    | 匹配 a~z 小写字母（连字符表示范围）    | `/[a-z]/` 匹配 "x" → true；匹配 "X" → false |
| `[a-zA-Z0-9]` | 匹配大小写字母+数字                  | `/[a-zA-Z0-9]/` 匹配 "5" → true；匹配 "_" → false |
| `[^a-z]`   | 取反（匹配除 a~z 外的字符），`^` 在中括号内 | `/[^a-z]/` 匹配 "5" → true；匹配 "x" → false |
| `.`        | 匹配除换行符外的任意单个字符          | `/a.b/` 匹配 "aab" → true；匹配 "acb" → true | 万能匹配，需谨慎使用              |

##### ④ 预定义类（常见字符集合的简写）
| 预定义类 | 等价写法              | 作用                                  | 示例                          |
|----------|-----------------------|---------------------------------------|-----------------------------------|
| `\d`     | `[0-9]`               | 匹配数字                              | `/\d{6}/` 匹配 6 位验证码          |
| `\D`     | `[^0-9]`              | 匹配非数字                            | `/\D/` 匹配 "a" → true              |
| `\w`     | `[a-zA-Z0-9_]`        | 匹配字母、数字、下划线                | `/\w{6,16}/` 匹配用户名            |
| `\W`     | `[^a-zA-Z0-9_]`       | 匹配非字母、数字、下划线              | `/\W/` 匹配 "-" → true（需注意：`-` 不在 `\w` 中） |
| `\s`     | `[ \t\n\r\f]`         | 匹配空格、制表符、换行符等空白字符    | `/\s/` 匹配 " " → true              |
| `\S`     | `[^ \t\n\r\f]`        | 匹配非空白字符                        | `/\S/` 匹配 "a" → true              |

#### （3）修饰符（控制匹配行为）
修饰符追加在正则分隔符后，用于约束匹配细节：

| 修饰符 | 作用                                  | 示例                          |
|--------|---------------------------------------|-----------------------------------|
| `i`    | ignore（忽略大小写）                  | `/abc/i` 匹配 "ABC" → true；匹配 "abc" → true |
| `g`    | global（全局匹配）                    | "aaa".replace(/a/g, "b") → "bbb"（无 g 则只替换第一个） |

- 补充知识点：`replace` 方法结合修饰符，用于敏感词过滤、批量替换：
  ```javascript
  // 全局替换敏感词
  const str = "pink老师上课很有**";
  const sensitiveReg = /敏感词1|敏感词2/g; // 多个敏感词用 | 分隔
  const result = str.replace(sensitiveReg, "**");
  ```


### 2. 综合案例：小兔鲜系列（核心实战）
案例围绕“注册-登录-首页”流程，整合正则表单验证、本地存储、倒计时、事件委托，核心是正则的实际应用。

#### （1）核心模块解析
##### ① 注册页面（重点：多表单正则验证）
| 表单项       | 正则表达式                          | 验证逻辑                                  |
|--------------|-----------------------------------|---------------------------------------|
| 用户名       | `/^[a-zA-Z0-9-_]{6,10}$/`          | 字母、数字、下划线、短横线，6~10位        |
| 手机号？       | `/^ 1(3\d | 4[5-9] | 5[0-35-9] | 6[567] | 7[0-8] | 8\d | 9[0-35-9]) \d{8} $/` | 中国大陆手机号规范（11位，号段匹配） |
| 验证码       | `/^\d{6}$/`                        | 6位数字                                |
| 密码         | `/^[a-zA-Z0-9-_]{6,20}$/`          | 字母、数字、下划线、短横线，6~20位        |
| 再次密码     | 与密码输入框值一致                  | 无需正则，直接比较值                    |
| 同意协议     | 勾选状态（`classList.contains('icon-queren2')`） | 提交前校验是否勾选                      |

- 验证触发：表单失去焦点（`blur` 或 `change` 事件），提交时统一校验所有表单。

##### ② 验证码倒计时模块
- 核心逻辑：点击“发送验证码”后，按钮禁用，60秒倒计时，结束后恢复可点击。
- 代码核心：`setTimeout` 或 `setInterval` 实现倒计时，结合 `disabled` 属性控制按钮状态。

##### ③ 登录页面
- 核心逻辑：阻止表单默认提交，校验同意协议状态，本地存储用户名，跳转首页。
- 关键：登录成功后用 `localStorage.setItem('username', 输入值)` 存储用户名。

##### ④ 首页页面
- 核心逻辑：读取本地存储的用户名，显示“欢迎xxx”；点击“退出登录”删除本地存储，恢复默认状态。
- 移动端适配：检测设备类型，跳转到移动端页面（结合 `navigator.userAgent`）。


## 四、常见错误与陷阱（高频）
1. **正则边界符遗漏导致匹配不精确**：
   - 错误：用户名验证用 `/[a-z0-9]{6,16}/`（无 `^$`），匹配 "123username123" 也返回 true。
   - 解决：必须加边界符 `/^[a-z0-9]{6,16}$/`，确保完全匹配。

2. **量词逗号两侧有空格**：
   - 错误：`/^a{2, 4}$/`（逗号后有空格），正则失效。
   - 解决：量词范围逗号两侧无空格，`/^a{2,4}$/`。

3. **元字符未转义**：
   - 错误：匹配 "." 用 `/./`（实际匹配任意字符）。
   - 解决：特殊元字符需转义 `\/`，匹配 "." 用 `/\./`。

4. **中文匹配错误**：
   - 错误：直接用 `/^[\u4e00-\u9fa5]$/` 但未指定长度，导致单个中文也通过。
   - 解决：结合量词，如昵称验证 `/^[\u4e00-\u9fa5]{2,8}$/`（2~8个中文）。

5. **全局替换忘记加 `g` 修饰符**：
   - 错误：`"aaa".replace(/a/, "b")` → "baa"（仅替换第一个）。
   - 解决：加 `g` 修饰符，`"aaa".replace(/a/g, "b")` → "bbb"。

6. **表单验证未阻止默认提交**：
   - 错误：注册页面提交时，未阻止表单默认跳转，验证失效。
   - 解决：`form.addEventListener('submit', (e) => e.preventDefault())`。


## 五、快速练习（把知识变成肌肉记忆）
### 1. 10 分钟任务（基础回顾）
- 任务 1：编写正则表达式验证手机号、6位验证码、8~16位密码（含字母、数字、下划线）。
- 任务 2：实现敏感词过滤（敏感词："垃圾"、"不良"），全局替换为 "**"。
- 任务 3：编写表单验证函数，失去焦点时验证用户名（6~10位字母/数字/下划线）。

### 2. 1 小时任务（综合应用）
- 需求：简化版小兔鲜注册页面核心功能：
  1. 用户名、手机号、验证码、密码表单，失去焦点验证。
  2. 发送验证码按钮，60秒倒计时，禁用状态切换。
  3. 提交按钮，校验所有表单通过后，提示注册成功。


## 六、代码片段（常用模板，拷贝即用）
### 1. 常用正则模板（表单验证）
```javascript
// 1. 用户名（6~10位，字母/数字/下划线/短横线）
const usernameReg = /^[a-zA-Z0-9-_]{6,10}$/;
// 2. 手机号（中国大陆）
const phoneReg = /^1(3\d|4[5-9]|5[0-35-9]|6[567]|7[0-8]|8\d|9[0-35-9])\d{8}$/;
// 3. 验证码（6位数字）
const codeReg = /^\d{6}$/;
// 4. 密码（6~20位，字母/数字/下划线/短横线）
const pwdReg = /^[a-zA-Z0-9-_]{6,20}$/;
// 5. 中文昵称（2~8位）
const nicknameReg = /^[\u4e00-\u9fa5]{2,8}$/;
```

### 2. 表单验证函数（用户名为例）
```javascript
function verifyUsername() {
  const username = document.querySelector('#username').value.trim();
  const tip = document.querySelector('.username-tip');
  if (usernameReg.test(username)) {
    tip.textContent = '格式正确';
    tip.className = 'username-tip right';
    return true;
  } else {
    tip.textContent = '请输入6~10位字母、数字、下划线或短横线';
    tip.className = 'username-tip wrong';
    return false;
  }
}
// 绑定失去焦点事件
document.querySelector('#username').addEventListener('blur', verifyUsername);
```

### 3. 敏感词过滤（全局替换）
```javascript
function filterSensitive(str) {
  const sensitiveWords = ['垃圾', '不良', '敏感词1', '敏感词2'];
  // 正则拼接：用 | 分隔敏感词，加 g 全局匹配
  const sensitiveReg = new RegExp(sensitiveWords.join('|'), 'g');
  return str.replace(sensitiveReg, '**');
}
// 使用
const originalStr = '这个内容包含垃圾和不良信息';
const filteredStr = filterSensitive(originalStr);
console.log(filteredStr); // 这个内容包含**和**信息
```

### 4. 验证码倒计时
```javascript
const codeBtn = document.querySelector('#sendCode');
let timer = null;
codeBtn.addEventListener('click', function() {
  let seconds = 60;
  this.disabled = true;
  this.textContent = `${seconds}秒后重新获取`;
  timer = setInterval(() => {
    seconds--;
    this.textContent = `${seconds}秒后重新获取`;
    if (seconds === 0) {
      clearInterval(timer);
      this.disabled = false;
      this.textContent = '重新获取验证码';
    }
  }, 1000);
});
```

### 5. 小兔鲜登录页面核心逻辑
```javascript
const loginForm = document.querySelector('#loginForm');
loginForm.addEventListener('submit', (e) => {
  e.preventDefault();
  const agree = document.querySelector('.agreement').classList.contains('icon-queren2');
  const username = document.querySelector('#loginUsername').value.trim();
  const pwd = document.querySelector('#loginPwd').value.trim();
  
  if (!agree) {
    alert('请勾选同意服务条款');
    return;
  }
  if (!username || !pwd) {
    alert('用户名和密码不能为空');
    return;
  }
  // 假设登录成功，存储用户名并跳转
  localStorage.setItem('username', username);
  location.href = 'index.html'; // 跳转到首页
});
```


## 八、复习计划（建议周期）
### 1. 每周（30 分钟）
- 回顾“核心概念速查”，重点记忆正则元字符（边界符、量词、预定义类）、常用正则模板。
- 完成 1 个“10 分钟任务”，如表单验证函数、敏感词过滤，巩固正则应用。

### 2. 每两周（2 小时）
- 完成 1 个“1 小时任务”，如简化版小兔鲜注册页面，整合正则验证、倒计时。
- 用正则测试工具（http://tool.oschina.net/regex）验证正则表达式的正确性。

### 3. 每月（半天）
- 独立完成小兔鲜完整案例（注册→登录→首页），重点练习表单验证流程、本地存储交互。
- 拓展练习：添加密码强度校验（正则匹配大小写字母、数字、特殊符号组合）。


## 九、自测题（检验掌握情况）
1. 正则表达式的核心作用有哪些？`test` 和 `exec` 方法的区别是什么？
2. 边界符 `^` 和 `$` 的作用是什么？如果遗漏会导致什么问题？
3. 量词 `{n,m}` 中逗号两侧为什么不能有空格？写出“匹配 3~8 位数字”的正则。
4. 预定义类 `\w` 和 `\d` 分别等价于什么字符集合？匹配非数字用哪个预定义类？
5. 修饰符 `i` 和 `g` 的作用是什么？如何实现敏感词的全局替换？
6. 写出中国大陆手机号的正则表达式，并说明号段匹配逻辑。
7. 小兔鲜注册页面中，提交表单时的校验流程是什么？如何确保所有表单都通过验证？


## 十、复习小贴士
1. **善用正则测试工具**：http://tool.oschina.net/regex 可实时验证正则表达式，排查匹配问题。
2. **元字符记忆技巧**：按“位置（边界符）→ 次数（量词）→ 字符（字符类）”分类记忆，结合示例理解。
3. **表单验证最佳实践**：失去焦点时实时验证，提交时统一校验，给出明确错误提示，提升用户体验。
4. **中文匹配注意**：中文的 Unicode 范围是 `[\u4e00-\u9fa5]`，需结合量词控制长度，避免单个中文通过验证。
5. **正则转义**：匹配 `.`、`*`、`+` 等特殊元字符时，需用 `\` 转义（如 `/\./` 匹配 "."）。
6. **案例多练**：小兔鲜案例是正则+本地存储+表单交互的综合应用，至少独立写 2 遍，熟练掌握流程。